
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Windows thumbcache - </title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="" class="md-header__button md-logo" aria-label="" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Windows thumbcache
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../community/" class="md-tabs__link">
          
  
  
  Community

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../contributions_mediawiki/" class="md-tabs__link">
          
  
  
  Contributions

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tags/" class="md-tabs__link">
          
  
  
  Tags

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="" class="md-nav__button md-logo" aria-label="" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Community
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Community
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../community/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Community
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contributions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Contributions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributions_mediawiki/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributions Mediawiki
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tags
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thumbcache-format" class="md-nav__link">
    <span class="md-ellipsis">
      Thumbcache Format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thumbnail-creation-process" class="md-nav__link">
    <span class="md-ellipsis">
      Thumbnail Creation Process
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linking-thumbnails-with-original-files" class="md-nav__link">
    <span class="md-ellipsis">
      Linking thumbnails with original files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linking thumbnails with original files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-windows-indexer" class="md-nav__link">
    <span class="md-ellipsis">
      Using Windows Indexer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using Windows Indexer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-windows-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Using Windows PowerShell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-hex-editor" class="md-nav__link">
    <span class="md-ellipsis">
      Using HEX editor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vista-windows-photo-gallery" class="md-nav__link">
    <span class="md-ellipsis">
      Vista Windows Photo Gallery
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-links" class="md-nav__link">
    <span class="md-ellipsis">
      External Links
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External Links">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thumbnailcacheid" class="md-nav__link">
    <span class="md-ellipsis">
      ThumbnailCacheId
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-english" class="md-nav__link">
    <span class="md-ellipsis">
      Non-English
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    <span class="md-ellipsis">
      Tools
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../tags/#tag:windows" class="md-tag">Windows</a>
      
    
  </nav>



  <h1>Windows thumbcache</h1>

<h2 id="overview">Overview</h2>
<p><a href="../windows_vista/">Windows Vista</a> stores <a href="../thumbnails/">thumbnails</a> in the
following directory:</p>
<pre><code>\Users\%username%\AppData\Local\Microsoft\Windows\Explorer
</code></pre>
<p>This directory contains following files:</p>
<ul>
<li>thumbcache_idx.db</li>
<li>thumbcache_32.db, thumbcache_96.db, thumbcache_256.db, and
  thumbcache_1024.db</li>
<li>thumbcache_sr.db</li>
</ul>
<p>Thumbnails are stored in <em>thumbcache_NN.db</em> files in different formats.
There are several tools that can work with Vista thumbcache database
(see below) and individual images can be extracted using <a href="../file_carving/">file
carving</a>. Unfortunately, there is no
information in the thumbcache database that can easily link thumbnails
with original files in all cases. One of the ways to link the thumbnails
with original files is to use the contents of the <a href="../windows_desktop_search/">Windows Search
(windows.edb)</a> database.</p>
<h2 id="thumbcache-format">Thumbcache Format</h2>
<p>In general, every thumbnail in cache is associated with two 64-bit
variables. First variable (sometimes called <em>Unique ID</em>, <em>Secret</em>, <em>File
ID</em>) associates data in file <em>thumbcache_idx.db</em> with thumbnail data in
<em>thumbcache_NN.db</em> files; the purpose of this variable is unclear.
Another variable is <em>Thumbnail Cache ID</em> (sometimes called <em>Thumbnail
filename</em> (in <a href="../forensic_toolkit/">FTK</a> is used to link
thumbnails with original files. Actually, <em>Thumbnail Cache ID</em> is
represented as Unicode string of HEX encoding.</p>
<h2 id="thumbnail-creation-process">Thumbnail Creation Process</h2>
<p><a href="../windows/">Windows</a> Vista creates thumbnails for files on
different media types, including:</p>
<ul>
<li>Removable devices</li>
<li>Network drives</li>
<li>Encrypted containers (e.g. PGP Desktop, <a href="../truecrypt/">TrueCrypt</a>, BestCrypt)</li>
</ul>
<p><a href="../windows/">Windows</a> Vista doesn't create thumbnails for files encrypted using
EFS unless thumbcache directory is encrypted too; <a href="../windows/">Windows</a> Vista
doesn't delete thumbnails for files after they were encrypted using EFS.</p>
<p>Some programs may generate thumbnails for some file types which are
displayed in Windows Explorer, but not stored in the thumbcache (e.g.
Ascon Kompas).</p>
<h2 id="linking-thumbnails-with-original-files">Linking thumbnails with original files</h2>
<h3 id="using-windows-indexer">Using Windows Indexer</h3>
<p>One way to link thumbnails with original files is to use Windows Indexer
database, which stores association between <strong>indexed</strong> files and
<em>ThumbnailCacheIDs</em> with some metadata. The windows.edb database file
contents can be extracted using <a href="http://www.simplecarver.com/tool.php?toolname=Windows%20Search%20Index%20Extractor">Windows Search Index
Extractor</a></p>
<h4 id="using-windows-powershell">Using Windows PowerShell</h4>
<p>Windows PowerShell provides easy way to access this database using SQL queries.
Note that most forensic tools (like FTK display <em>ThumbnailCacheID</em>
(where FTK calls it <em>Thumbnail filename</em>) in hexadecimal, but Windows PowerShell
returns the result in decimal.</p>
<h4 id="using-hex-editor">Using HEX editor</h4>
<p>You can also search for <em>ThumbnailCacheID</em> value in <em>Windows.edb</em> file
using your favorite HEX editor.</p>
<h3 id="vista-windows-photo-gallery">Vista Windows Photo Gallery</h3>
<p>Windows Vista includes a built-in picture previewing tool called Windows
Photo Gallery (the LIVE edition may also be installed by the user). Both
of these programs create the files <em>pictures.pd4</em> and <em>pictures.pd5</em>
respectively containing the <em>ThumbnailCacheID</em> and file path information
of previewed pictures and videos. The contents of the pictures.pd4 and
pictures.pd5 can be extracted using <a href="http://www.simplecarver.com/tool.php?toolname=WPG%20Viewer">WPG Viewer</a></p>
<h2 id="external-links">External Links</h2>
<ul>
<li><a href="https://github.com/libyal/libwtcdb/blob/main/documentation/Windows%20Explorer%20Thumbnail%20Cache%20database%20format.asciidoc">Windows Explorer Thumbnail Cache database (thumbcache.db) format</a>,
  by the <a href="../libwtcdb/">libwtcdb project</a></li>
</ul>
<h3 id="thumbnailcacheid">ThumbnailCacheId</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/properties/props-system-thumbnailcacheid">System.ThumbnailCacheId</a></li>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/api/thumbcache/nn-thumbcache-ithumbnailcache">IThumbnailCache interface</a></li>
</ul>
<h3 id="non-english">Non-English</h3>
<ul>
<li>Использование централизованных баз данных эскизов для исследования
  графических файлов на зашифрованных разделах, ITDefence, 2009 (<a href="https://www.securitylab.ru/analytics/370474.php">extended version</a>)</li>
<li><a href="https://it-forensik.fiw.hs-wismar.de/images/a/a5/BT_SAugustin.pdf">Forensische Analyse des Microsoft Windows Thumbnail Cache</a>,
  by Stefan Augustin, August 2023</li>
</ul>
<h2 id="tools">Tools</h2>
<ul>
<li><a href="../forensic_toolkit/">FTK</a></li>
<li><a href="http://www.janusware.com/?page=412,2">Thumbs.db Viewer</a></li>
<li><a href="https://thumbcacheviewer.github.io/">Thumbcache-viewer</a></li>
<li><a href="http://www.simplecarver.com/tool.php?toolname=WinThumbs%20Extractor">WinThumbs</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>